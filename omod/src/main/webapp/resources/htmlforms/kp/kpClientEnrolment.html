<!--
  ~ The contents of this file are subject to the OpenMRS Public License
  ~ Version 1.0 (the "License"); you may not use this file except in
  ~ compliance with the License. You may obtain a copy of the License at
  ~ http://license.openmrs.org
  ~
  ~ Software distributed under the License is distributed on an "AS IS"
  ~ basis, WITHOUT WARRANTY OF ANY KIND, either express or implied. See the
  ~ License for the specific language governing rights and limitations
  ~ under the License.
  ~
  ~ Copyright (C) OpenMRS, LLC.  All Rights Reserved.
-->
<htmlform>


    <script type="text/javascript" src="../moduleResources/kenyaemr/scripts/moment.js"></script>
    <script type="text/javascript">

        function onHistoricalStatusDateChange() {

            var today = new Date()//.getTime();        //get current date
            var patientId = <lookup expression="patient.patientId"/>;


            /*this data should not be in Future */
            if (ENC_DATE &gt; today) {
                getField('encounter-date.error').html('Should not be greater than the Current date').show();
            }
            else if(ENC_DATE &lt; bithYear)
            {
                /* Encounter Date should be greater than the Patients's date of Birth    */
                getField('encounter-date.error').html('Should not be less than the date of Birth').show();
            }
            else
            {
                getField('encounter-date.error').hide();
            }

            jq.getJSON('/' + OPENMRS_CONTEXT_PATH + '/kenyaemr/patient/patientUtils/age.action', { patientId: patientId, now: encDate })
                .done(function(data) {
                    onPatientAgeUpdate(data.age);
                });


        }
        function everTestedSelected() {
            var val = jq(this).val();
            var everTested = getValue('ever-tested.value');
            if(val == 1065){
                jq("#test-type-tr").show();
                jq("#share-test-tr").show();
                jq("#tbl-receiving-care").show();
                jq("#tbl-vl-status").show();
                jq("#willing-to-test").hide();
            }
            if(val == 1066){
                jq("#willing-to-test").show();
                jq("#test-type-tr").hide();
                jq("#share-test-tr").hide();
                jq("#tbl-receiving-care").hide();
                jq("#tbl-vl-status").hide();
                jq("#test-type input").prop('checked', false);
                jq("#share-test input").prop('checked', false);
                jq("#vl-test-done input").prop('checked', false);
                getField('vl-date.value').val("");
                getField('ccc-number.value').val("");
                getField('facility-name.value').val("");
                getField('receiving-care.value').val("");
            }
        }
        function receivingCareSelected() {
            var val = jq(this).val();
           if(val == 1065){
               jq("#ccc-number :input").prop('disabled', false);
               jq("#facility-name :input").prop('disabled', false);
            }
            if(val == 1066){
                getField('ccc-number.value').val("");
                getField('facility-name.value').val("");
                jq("#ccc-number :input").prop('disabled', true);
                jq("#facility-name :input").prop('disabled', true);

            }
        }
        function vlTestDoneSelected() {
            var val = jq(this).val();
            if(val == 1065){
                jq("#vl-date :input").prop('disabled', false);
            }
            if(val == 1066){
                getField('vl-date.value').val("");
                jq("#vl-date :input").prop('disabled', true);
            }
        }
        function willingTesterSelected() {
            var val = jq(this).val();
            if(val == 1065){
                jq("#decline-reason select").prop('disabled', false);
            }
            if(val == 1066){
                jq("#decline-reason select").prop('disabled', true);
                getField('decline-reason.value').prop("selectedIndex", 0);
            }
        }
        $(document).ready(function () {
            $("#date").datepicker({
                changeMonth: false,
                changeYear: true,
                dateFormat: 'dd/mm/yy',
                duration: 'fast',
                stepMonths: 0
            });

            jq("#NonePayingSex").hide();
            jq("#clientphysiaclViolence").hide();
            jq("#historicalPhysicalViolence").hide();
            jq("#sexuaViolence").hide();
            jq("#peer_work_name").hide();
            jq("#year_started_sex").hide();
            jq("#yearStartedSexWithMen").hide();
            jq("#yearStartedDrugs").hide();
            jq("#test-type-tr").hide();
            jq("#share-test-tr").hide();
            jq("#tbl-receiving-care").hide();
            jq("#tbl-vl-status").hide();
            jq("#willing-to-test").hide();

            jq('#ever-tested :input[type=radio]').change(everTestedSelected);
            jq('#receiving-care :input[type=radio]').change(receivingCareSelected);
            jq('#vl-test-done :input[type=radio]').change(vlTestDoneSelected);
            jq('#willing-tester :input[type=radio]').change(willingTesterSelected);

            var sexViolenceckbox = $('#w33_0');
            $('input').on('click',function () {
                if (sexViolenceckbox.is(':checked')) {
                    jq("#sexuaViolence").show();

                } else {
                    jq("#sexuaViolence").hide();
                }
            });

            var physicalViolenceckbox = $('#w37_0');
            $('input').on('click',function () {
                if (physicalViolenceckbox.is(':checked')) {
                    jq("#historicalPhysicalViolence").show();
                } else {
                    jq("#historicalPhysicalViolence").hide();
                }
            });

            var nonepaying_ckbox = $('#w17_0');
            $('input').on('click',function () {
                if (nonepaying_ckbox.is(':checked')) {
                    jq("#NonePayingSex").show();
                } else {
                    jq("#NonePayingSex").hide();
                }
            });


            var peer_work_name = $('#w13_0');
            $('input').on('click',function () {
                if (peer_work_name.is(':checked')) {
                    jq("#peer_work_name").show();
                } else {
                    jq("#peer_work_name").hide();
                }
            });


            $('input').on('click',function () {
                var partnerNumber = getField('pNumber.value').val();
                if (partnerNumber !== "") {

                    var phoneNum = /^\(?([0-9]{3})\)?[-. ]?([0-9]{3})[-. ]?([0-9]{4})$/;
                    if (partnerNumber.match(phoneNum)) {
                        getField('pNumber.error').html('Please enter valid phone number.').hide();
                    } else {
                        getField('pNumber.error').html('Please enter valid phone number.').show();
                        $('#w25').val('');
                        return false;
                    }
                }
            });

            $('input').on('click',function () {

                var mobileNumber = getField('mobile.value').val();
                if (mobileNumber !== "") {

                    var phoneNum = /^\(?([0-9]{3})\)?[-. ]?([0-9]{3})[-. ]?([0-9]{4})$/;
                    if (mobileNumber.match(phoneNum)) {
                        getField('mobile.error').html('Please enter valid phone number.').hide();
                    } else {
                        getField('mobile.error').html('Please enter valid phone number.').show();
                        $('#w55').val('');
                        return false;
                    }
                }
            });

            $('input').on('click',function () {

                var alternateNumber = getField('alterNumber.value').val();
                if (alternateNumber !== "") {

                    var phoneNum = /^\(?([0-9]{3})\)?[-. ]?([0-9]{3})[-. ]?([0-9]{4})$/;
                    if (alternateNumber.match(phoneNum)) {
                        getField('alterNumber.error').html('Please enter valid phone number.').hide();
                    } else {
                        getField('alterNumber.error').html('Please enter valid phone number.').show();
                        $('#w57').val('');
                        return false;
                    }
                }
            });

            $('input').on('click',function () {

                var year_startSex_work = getField('startSex.value').val();
                var year_start_having_sex_with_men = getField('sexWithMen.value').val();
                var year_stared_using_drugs = getField('usingDrugs.value').val();

                yearValidation(year_startSex_work, 'startSex')
                yearValidation(year_start_having_sex_with_men,  'sexWithMen')
                yearValidation(year_stared_using_drugs, 'usingDrugs')


            });

            function yearValidation(year, textfield) {


                if (year != 0) {
                    var test=year;
                    if (year.length != 4) {
                        getField(textfield+'.error').html('Please enter valid year.').show();
                        getField(textfield+'.value').val('');
                        return false;
                    }

                    var birthDate= ('(<lookup expression="patient.birthdate"/>)');
                    var bithYear = birthDate.substring(8);
                    if(year &lt; bithYear)
                    {
                        /* Encounter Date should be greater than the Patients's date of Birth    */
                        getField(textfield+'.error').html('Should not be less than the date of Birth').show();
                        getField(textfield+'.value').val('');
                        return false;
                    }
                    else
                    {
                        getField(textfield+'.error').hide();
                    }

                    var current_year = new Date().getFullYear();
                    if ((year > current_year)) {
                        getField(textfield+'.error').html('Year should not be greater than current year.').show();
                        getField(textfield+'.value').val('');
                        return false;
                    }
                    getField(textfield+'.error').html('Please enter valid year.').hide();
                }
            }
        });

        beforeSubmit.push(function() {

            var enrolment_area = getField('enrolment_area.value').val();
            var peer_educator = getField('peer-educator.value').val();
            var peer = getField('peer.value').val();
            var regular_sex_partner = getField('regular-sex-partner.value').val();
            var partner_name = getField('pName.value').val();
            var partner_alias = getField('pAlias.value').val();
            var partner_number = getField('pNumber.value').val();
            var start_sex = getField("startSex.value").val();

            var sex_with_men = getField("sexWithMen.value").val();
            var using_drugs = getField("usingDrugs.value").val();
            var experience_sex_violence = getField("exprienced-sex-violence.value").val();
            var sex_violence_ordeal = getField("sOrdeal.value").val();
            var physical_ordeal = getField("exprienced-physical-violence.value").val();
            var historical_ordeal = getField("hOrdeal.value").val();
            var contatcted_incase_of_appointment = getField("contacted-incase-of-appointment.value").val();
            var clinical_contatcted = getField("cContacted.value").val();

            var contacted_by_eductaor = $('#w13_0');
            var notContacted = $('#w13_1');


            if (contacted_by_eductaor.is(':checked') || notContacted.is(':checked')) {
                getField('peer-educator.error').html('Please indicate whether you have been contacted or not').hide();
            } else {
                getField('peer-educator.error').html('Please indicate whether you have been contacted or not').show()
                return false;
            }



            var has_regular_sex_partner = $('#w17_0');
            var doesnot_regular_sex_partner = $('#w17_1');


            if (has_regular_sex_partner.is(':checked') || doesnot_regular_sex_partner.is(':checked')) {
                getField('regular-sex-partner.error').html('Please indicate if you have regular sex partner.').hide();
            } else {
                getField('regular-sex-partner.error').html('Please indicate if you have regular sex partner.').show()
                return false;
            }


            if (partner_number != "") {

                var phoneNum = /^\(?([0-9]{3})\)?[-. ]?([0-9]{3})[-. ]?([0-9]{4})$/;
                if (partner_number.match(phoneNum)) {
                    getField('pName.error').html('Please enter partner number.').hide();
                } else {
                    getField('pNumber.error').html('Please enter valid phone number.').show();
                    return false;
                }
            }

        });
    </script>
    <div class="ke-form-header">
        <table style="width: 100%">
            <tr>
                <td align="left">Enrolment Date:
                    <encounterDate id="encounter-date" showTime="true"/>
                </td>
                <td align="right">Location:
                    <encounterLocation default="GlobalProperty:kenyaemr.defaultLocation" type="autocomplete"/>
                </td>
            </tr>
        </table>
    </div>

    <div class="ke-form-content">

        <fieldset>
        </fieldset>
        <fieldset>
            <legend>Client Enrolment Social Status</legend>

            <table>
                <tr>
                    <td>Have you been contacted by a peer educator for prevention services?</td>
                    <td>
                        <obs id="peer-educator" conceptId="165004"
                             answerConceptIds="1065AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,1066AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"
                             answerLabels="Yes,No"
                             style="radio" />
                    </td>
                </tr>
                <tr>
                    <table id="peer_work_name" >
                        <td>Peer Educator/Outreach Worker name</td>
                        <td>
                            <obs id="peer" conceptId="1473"/>

                        </td>
                    </table>
                </tr>
                <tr>
                    <td>Do you have a regular(Non-Paying) sexual partner?</td>
                    <td>
                        <obs id="regular-sex-partner" conceptId="165027"
                             answerConceptIds="1065AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,1066AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"
                             answerLabels="Yes,No"
                             style="radio" />
                    </td>
                </tr>
                <tr>
                    <table id="NonePayingSex" >

                        <td>If yes, partners name</td>
                        <td>
                            <obs id="pName" conceptId="161135"/>
                        </td>
                        <td>Alias Name</td>
                        <td>
                            <obs id="pAlias" conceptId="165028"/>
                        </td>
                        <td>Contact Number</td>
                        <td>
                            <obs id="pNumber" conceptId="159635"/>
                        </td>

                    </table>

                </tr>
            </table>
        </fieldset>

        <fieldset>
            <legend>Historical Status</legend>

            <table>
                <tr id="year_started_sex">
                    <td>Which year did you start sex work?</td>
                    <td>
                        <obs id="startSex" conceptId="165030"/>
                    </td>
                </tr>
                <tr id="yearStartedSexWithMen">
                    <td>Which year did you start having sex with men?</td>
                    <td>
                        <obs id="sexWithMen" conceptId="165031"/>
                    </td>
                </tr>
                <tr id="yearStartedDrugs">
                    <td>Which Year Did You Start Using Drugs (Injecting Or Smoking)?</td>
                    <td>
                        <obs id="usingDrugs" conceptId="165032"/>

                    </td>
                </tr>
                <tr>
                    <td>
                        Ever experienced sexual violence?</td>
                    <td>
                        <obs id="exprienced-sex-violence" conceptId="123160"
                             answerConceptIds="1065AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,1066AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"
                             answerLabels="Yes,No"
                             style="radio" />
                    </td>
                    <table id="sexuaViolence" >


                        <td>If yes, describe the ordeal</td>
                        <td>
                            <obs id="sOrdeal" conceptId="165033" rows="2" cols="80"/>
                        </td>
                    </table>
                </tr>
                <tr>
                    <td>Ever experienced physical violence?</td>
                    <td>
                        <obs id="exprienced-physical-violence" conceptId="165034"
                             answerConceptIds="1065AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,1066AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"
                             answerLabels="Yes,No"
                             style="radio" />
                    </td>
                    <table id="historicalPhysicalViolence">
                        <td>If yes, describe the ordeal</td>
                        <td>
                            <obs id="hOrdeal" conceptId="165035" rows="2" cols="80" />
                        </td>
                    </table>
                </tr>
            </table>
        </fieldset>

        <fieldset>
            <table>
                <tr>
                    <td>
                        Have you ever been tested for HIV?
                    </td>
                    <td>
                        <obs id="ever-tested" conceptId="164401AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"
                             answerConceptIds="1065AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,1066AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"
                             answerLabel="Yes,No"
                             style="radio" />
                    </td>
                </tr>
                <tr id="test-type-tr">
                    <td>
                        The last time you received HIV testing, how did you test?
                    </td>
                    <td>
                        <obs id="test-type" conceptId="164956"
                             answerConceptIds="163722AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,164952"
                             answerLabel="Rapid HIV Testing,Self Test"
                             style="radio" />
                    </td>
                </tr>
                <tr id="share-test-tr" >
                    <td>
                        Would you like to share your LAST test result with me?  (circle the number)
                    </td>
                    <td>
                        <obs id="share-test" conceptId="165153"
                             answerConceptIds="703AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,664AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,1066AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"
                             answerLabels="Yes I tested positive,
                                           Yes I tested negative,
                                           No I do not want to share"
                             style="radio" />
                    </td>
                </tr>
            </table>

        </fieldset>
        <fieldset>

            <table id="tbl-receiving-care">
                <tr>
                    <td>
                        Are you receiving HIV care? &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;
                        <obs id="receiving-care" conceptId="159811AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"
                             answerConceptIds="1065AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,1066AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"
                             answerLabel="Yes,No"
                             style="radio" />
                        &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;
                        Facility name: &#160;&#160;&#160;&#160;&#160;&#160;
                        <obs id="facility-name"  conceptId="162724AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"/>
                        &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;CCC Number:&#160;&#160;&#160;&#160;
                        <obs id="ccc-number" conceptId="162053AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"/>
                    </td>
                </tr>
            </table>

            <table id="tbl-vl-status">
                <tr>
                    <td>

                        Viral Load Test done? &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;
                        <obs id="vl-test-done" conceptId="164437AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"
                             answerConceptIds="1065AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,1066AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"
                             answerLabel="Yes,No"
                             style="radio" />
                    </td>


                    <td>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;
                        VL results date:&#160;&#160;&#160;&#160;
                        <obs id ="vl-date" conceptId="163281AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"/>
                    </td>
                </tr>
            </table>
            <table id="willing-to-test">
                <tr>
                    <td>
                        Are you willing to be tested for HIV?&#160;&#160;&#160;
                        <obs id="willing-tester" conceptId="165154"
                             answerConceptIds="1065AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,1066AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"
                             answerLabel="Yes,No"
                             style="radio" />
                    </td>

                    <td>
                        &#160;&#160;&#160;&#160;&#160;
                        Reason:&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;
                        <obs id="decline-reason" conceptId="159803AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"/>

                    </td>
                </tr>

            </table>
        </fieldset>
        <fieldset>
            <legend>Client Support</legend>

            <table>
                <tr>
                    <td>Would you like to be contacted in case you are due for a clinical appointment?</td>
                    <td>
                        <obs id="contacted-incase-of-appointment" conceptId="165036"
                             answerConceptIds="1065AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,1066AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"
                             answerLabels="Yes,No"
                             style="radio" />
                    </td>
                </tr>
                <tr>
                    <td>If yes, How would you like to be contacted</td>
                    <td>
                        <obs id="cContacted" conceptId="164966"
                             answerConceptIds="161642,165037,1555,159635"
                             answerLabels="Treatment supporter,Peer educator,Outreach worker,Phone number"/>
                    </td>
                </tr>
            </table>
        </fieldset>

        <fieldset>
            <legend>Buddy Contact Information</legend>

            <table>
                <tr>
                    <td>Treatment supporter Name</td>
                    <td>
                        <obs id="fname" conceptId="160638"/>
                    </td>
                    <td>Alias Name</td>
                    <td>
                        <obs id="alias" conceptId="165038"/>
                    </td>
                </tr>
                <tr>
                    <td>Mobile Number</td>
                    <td>
                        <obs id="mobile" conceptId="160642"/>
                    </td>
                    <td> Alternative Mobile Number</td>
                    <td>
                        <obs id="alterNumber" conceptId="159635"/>
                    </td>
                </tr>
                <tr>
                    <td>Enrolment Notes</td>
                    <td>
                        <obs id="enNotes" conceptId="161011" rows="2" cols="80"/>
                    </td>
                </tr>
            </table>
        </fieldset>

        <enrollInProgram programId="7447305a-18a7-11e9-ab14-d663bd873d93"/>
    </div>

    <div class="ke-form-footer">
        <submit/>
    </div>

</htmlform>